<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Cinemate | Settings</title>

  <link rel="stylesheet" href="../css/Settings.css" />
  <link rel="stylesheet" href="../css/theme.css" />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">
  <script type="module" src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>
  <script nomodule src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.js"></script>
</head>
<body>
  <nav>
    <div class="logo">ðŸŽ¬ Cinemate</div>
    <ul>
      <li><a href="/dashboard"><ion-icon name="home-outline"></ion-icon> Home</a></li>
      <li><a href="/watching"><ion-icon name="play-circle-outline"></ion-icon> Watching</a></li>
      <li><a href="/finished"><ion-icon name="checkmark-circle-outline"></ion-icon> Finished</a></li>
      <li><a href="/wishlist"><ion-icon name="bookmark-outline"></ion-icon> Planned</a></li>
      <li><a href="#" class="active"><ion-icon name="settings-outline"></ion-icon> Settings</a></li>
    </ul>
  </nav>

  <main class="main-container">
    <div class="settings-container">
      <h2>Settings</h2>

      <div class="settings-option" id="profile-option">
        <span>Profile</span>
        <ion-icon name="chevron-forward-outline"></ion-icon>
      </div>

      <div class="settings-option" id="password-option">
        <span>Password</span>
        <ion-icon name="chevron-forward-outline"></ion-icon>
      </div>

      <div class="settings-option" id="theme-option">
        <span>Theme</span>
        <label class="toggle-switch">
          <input type="checkbox" id="theme-toggle-option">
          <span class="slider"></span>
        </label>
      </div>

      <button class="delete-option" id="logout-btn">Logout</button>
      <button class="delete-option" id="delete-btn">Delete Account</button>
    </div>
  </main>

  <script src="../js/theme.js"></script>
  <script>
    try {
      authManager.requireAuth();
    } catch (err) {
      console.warn("Auth manager error:", err);
    }

    const body = document.body;
    const themeToggle = document.getElementById("theme-toggle-option");
    const themeOption = document.getElementById("theme-option");

    if (localStorage.getItem("theme") === "dark") {
      body.classList.add("dark-theme");
      themeToggle.checked = true;
    }

    themeOption.addEventListener("click", (e) => {
      if (e.target.tagName.toLowerCase() !== "input") {
        themeToggle.checked = !themeToggle.checked;
      }
      if (themeToggle.checked) {
        body.classList.add("dark-theme");
        localStorage.setItem("theme", "dark");
      } else {
        body.classList.remove("dark-theme");
        localStorage.setItem("theme", "light");
      }
    });

    function navigateOnClick(divId, url) {
      const el = document.getElementById(divId);
      if (!el) return;
      el.style.cursor = "pointer";
      el.addEventListener("click", () => window.location.href = url);
    }

    navigateOnClick("profile-option", "/settings/profile");
    navigateOnClick("password-option", "/settings/password");
    // profile-option

    const profile = document.getElementById("profile-option");
    


    const logoutBtn = document.getElementById("logout-btn");
    logoutBtn.addEventListener("click", () => {
    fetch("/api/auth/logout", { method: "POST" })
      .then(res => res.json())
      .then(data => {
        if (data.success) {
          window.location.href = "/login";
        }else{
          console.log("error logging out");
        }
      });
    });

    const deleteBtn = document.getElementById("delete-btn");
    deleteBtn.addEventListener("click", () => {
      fetch ("/api/auth/delete",{method:"DELETE",credentials:"include"})
      .then(res => res.json())
      .then(data => {
        if (data.success) {
          window.location.href = "/signup";
        }else{
          console.log("error deleting account");
        }
      });
    });
  </script>
  <!-- <script src="../js/password.js"></script> -->
</body>
</html>
